<h1><%= @destination.name %></h1>

<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      #map {
        height: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map" data-destination="<%= @to_do.to_json %>"></div>
    <script>
      var data = JSON.parse(document.getElementById('map').getAttribute("data-destination"));
      
      var map;
      var markers = [];
      var infowindows = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: data[0].latitude, lng: data[0].longitude},
          zoom: 6
        }); 
        
        for(var i = 0; i < data.length; i++) {
          var myLatlng = new google.maps.LatLng(data[i].latitude, data[i].longitude);

          markers[i] = new google.maps.Marker({
            position: myLatlng,
            title:"Hello World!"
          });

          markers[i].index = i;

          infowindows[i] = new google.maps.InfoWindow({
            content: data[i].activity
          });

          markers[i].setMap(map);

          google.maps.event.addListener(markers[i], 'click', function() {
            infowindows[this.index].open(map,markers[this.index]);
          });  
        }
      };

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4N_mFX8V-8eJ7a7P_R8_YVniDRkzVaqY&callback=initMap"
    async defer></script>
  </body>
</html>